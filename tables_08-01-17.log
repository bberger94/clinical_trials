
  ___  ____  ____  ____  ____ (R)
 /__    /   ____/   /   ____/
___/   /   /___/   /   /___/   14.2   Copyright 1985-2015 StataCorp LLC
  Statistics/Data Analysis            StataCorp
                                      4905 Lakeway Drive
     MP - Parallel Edition            College Station, Texas 77845 USA
                                      800-STATA-PC        http://www.stata.com
                                      979-696-4600        stata@stata.com
                                      979-696-4601 (fax)

18-user 8-core Stata network perpetual license:
       Serial number:  501406201034
         Licensed to:  National Bureau of Economic Research
                       Cambridge, MA 02138

Notes:
      1.  Stata is running in batch mode.
      2.  Unicode is supported; see help unicode_advice.
      3.  More than 2 billion observations are allowed; see help obs_advice.
      4.  Maximum number of variables is set to 5000; see help set_maxvar.


running /disk/admin/Linux-local/stata14/sysprofile.do ...

. do "source/02_figures_tables/tables_08-01-17.do" 

. ***********************************************************
. ** Author: Ben Berger; Date Created: 7-30-17              
. ** This script:
. ** 1. Loads the cortellis clinical trials data 
. ** 2. Makes some small modifications to phase variables    
. ** 3. Defines the universe of trials we are interested in
. ** 4. Generates useful variables for analysis
. ** 5. Runs programs to generate tables
. ***********************************************************
. 
. set more off

. ***************************************************
. **** Load Data ************************************
. ***************************************************
. local trial_data "data/clinical_trials_07-29-17.dta"

. local trial_data_sample "data/ct_sample.dta"

. 
. **Write a sample to disk for testing code
. /*
> use `trial_data', clear
> set seed 101
> sample 10 
> save `trial_data_sample', replace
> */
. 
. //use `trial_data_sample', clear
. use `trial_data', clear

. 
. 
. ***************************************************
. **** Clean data ***********************************
. ***************************************************
. 
. ***Trial start and end years
. gen year_start = year(date_start)
(23,973 missing values generated)

. gen year_end = year(date_end)
(99,984 missing values generated)

. 
. **Select universe of trials
. keep if year_start >= 1995 & year_start <= 2016
(39,365 observations deleted)

. keep if phase_1 == 1 | phase_2 == 1 | phase_3 == 1
(103,211 observations deleted)

. 
. **Recode trials with multiple phase designations as the earlier phase
. ***(ie. Phase 2/Phase 3 -> Phase 2 )
. replace phase_2 = 0 if phase_1 == 1 & phase_2 == 1
(10,440 real changes made)

. replace phase_3 = 0 if phase_2 == 1 & phase_3 == 1
(5,338 real changes made)

. **Verify the recoding was successful (both should return 0)
. count if phase_1 & phase_2
  0

. assert `r(N)' == 0

. count if phase_2 & phase_3
  0

. assert `r(N)' == 0

. 
. 
. ***************************************************
. **** Generate useful variables ********************
. ***************************************************
. 
. ***Trial duration in months
. gen duration = (date_end - date_start) / 30
(36,786 missing values generated)

. label variable duration "Trial duration in months"

. ****Recode as missing if duration is less 1 day or greater than 1000 months
. replace duration = . if duration <= 0
(1,408 real changes made, 1,408 to missing)

. replace duration = . if duration > 1000
(0 real changes made)

. 
. **Neoplasm indication dummy
. gen neoplasm = 0

. foreach var of varlist icd9_chapter_* {
  2.         replace neoplasm = 1 if `var' == "Neoplasms"
  3. }
(43,004 real changes made)
(844 real changes made)
(114 real changes made)
(41 real changes made)
(30 real changes made)
(9 real changes made)
(6 real changes made)
(9 real changes made)
(5 real changes made)
(0 real changes made)
(2 real changes made)
(3 real changes made)
(1 real change made)
(2 real changes made)
(0 real changes made)
(2 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)
(0 real changes made)

. 
. **Label variable values 
. cap label drop biomarker_label

.         label define biomarker_label 0 "No biomarker" 1 "Biomarker"

.         label values biomarker_status biomarker_label

. cap label drop nih_label

.         label define nih_label 0 "No funding" 1 "NIH funding"

.         label values nih_funding nih_label

. cap label drop year_labels

.         label define year_labels 1995 1995

.         label values year_start year_labels

.         label values year_end year_labels

. 
. **Label variables
. label variable biomarker_status "Uses biomarker" 

. label variable phase_1 "Phase 1 Clinical"

. label variable phase_2 "Phase 2 Clinical"

. label variable phase_3 "Phase 3 Clinical"

. label variable nih_funding "Received NIH funding" 

. label variable us_trial "Trial site in US" 

. label variable neoplasm "Drug indication for neoplasm"

. label variable therapeutic_marker_role "Biomarker role: therapeutic effect"

. label variable disease_marker_role "Biomarker role: disease"

. label variable toxic_marker_role "Biomarker role: toxic effect"

. label variable not_determined_marker_role "Biomarker role: not determined"

. 
. 
. 
. ***************************************************
. **** Generate figures and tables ******************
. ***************************************************
. 
. **Define directory for reports
. set more off

. local report_dir "reports/report_08-01-17"

. local table_dir "`report_dir'/tables"

. local figure_dir "`report_dir'/figures"

. 
. foreach dir in `report_dir' `table_dir' `figure_dir' {
  2.         !mkdir "`dir'"
  3. }

mkdir: cannot create directory `reports/report_08-01-17': File exists

mkdir: cannot create directory `reports/report_08-01-17/tables': File exists

mkdir: cannot create directory `reports/report_08-01-17/figures': File exists

. 
. **Load table programs
. do "source/02_figures_tables/tables_fns_edit7-30.do"

. **HELPER FUNCTIONS**
. *Make phase into a factor variable with 3 levels
. cap program drop prep_phases

. program define prep_phases
  1.         syntax, ///
>         
  2.         drop phase
  3.         gen phase = .
  4.         replace phase = 1 if phase_1 == 1
  5.         replace phase = 2 if phase_2 == 1
  6.         replace phase = 3 if phase_3 == 1
  7.         
.         cap label drop phase_label
  8.                 label define phase_label 1 "Phase I" 2 "Phase II" 3 "Phase
>  III"
  9.                 label values phase phase_label
 10.                 
.         gen phase_123 = (phase_1 | phase_2 | phase_3)
 11. end

. 
. 
. 
. 
. 
. 
. **MAIN TABLE & FIGURE FUNCTIONS**
. **Variable means
. cap program drop summary_stats

. program define summary_stats
  1.         syntax, ///
>         [table_path(string)] ///
>         [title(string)]
  2.         
.         preserve
  3.         local vars      biomarker_status ///
>                         phase_1 phase_2 phase_3 ///
>                         nih_funding ///
>                         us_trial ///
>                         neoplasm ///
>                         therapeutic_marker_role ///
>                         disease_marker_role ///
>                         toxic_marker_role ///
>                         not_determined_marker_role ///
> 
  4.         quietly estpost summarize `vars'
  5.         
.         if "`title'" == "" local title "Summary statistics for selected varia
> bles"
  6.         if "`table_path'" != "" local write_tex "using `table_path'"
  7.         
.         esttab . `write_tex', replace ///
>                 cells("mean(fmt(4)) min(fmt(0)) max(fmt(0)) count(fmt(%9.0gc)
> )") ///
>                 scalars(N) ///
>                 collabels("Mean" "Minimum" "Maximum" "Observations") ///
>                 nomtitle nonum noobs label ///
>                 title("`title'") ///
>                 sfmt(%9.0gc)
  8. 
.         restore 
  9.                 
. end

. 
. 
. 
. 
. *NIH funding by Phase
. cap program drop nih_funding_by_phase

. program define nih_funding_by_phase
  1.         syntax, ///
>         [table_path(string)] ///
>         [title(string)]
  2. 
.         preserve
  3.         
.         estimates clear
  4.         eststo p: quietly mean nih_funding
  5.         eststo p1: quietly mean nih_funding if phase_1
  6.         eststo p2: quietly mean nih_funding if phase_2
  7.         eststo p3: quietly mean nih_funding if phase_3
  8. 
.         if "`title'" == "" local title "Share of trials receiving NIH funding
>  by Phase"
  9.         if "`table_path'" != "" local write_tex "using `table_path'"
 10. 
.         esttab p p1 p2 p3 `write_tex', replace ///
>                 title("`title'") ///
>                 mtitles("Phase I-III" "Phase I" "Phase II" "Phase III") ///
>                 b(4) se nostar noobs ///
>                 scalar(N) sfmt(0) ///
>                 nonum label 
 11. 
.         restore
 12. end

. 
. 
. *Trial count by phase
. cap program drop trial_count_by_phase

. program define trial_count_by_phase
  1.         syntax, ///
>         [figure_path(string)] ///
>         [title(string)]
  2. 
.         preserve
  3.         *Count number of trials by year and phase
.         collapse (sum) phase_1 phase_2 phase_3, by(year_start) 
  4. 
.         if "`title'" == "" local title "Number of registered Phase I-III tria
> ls (1995-2016)"
  5.         graph bar phase_*, ///  
>                 over(year_start, label(angle(290))) ///
>                 title("`title'", size(medium)) ///
>                 ytitle("Number of trials") ///
>                 ylabel(,angle(0)) ///
>                 legend( lab(1 "Phase I") ///
>                         lab(2 "Phase II") ///
>                         lab(3 "Phase III") ///
>                         rows(1) ///
>                         ) 
  6.         if "`figure_path'" != "" graph export "`figure_path'", replace
  7.                         
.         restore
  8. end

. 
. *Trial growth by phase
. cap program drop trial_growth_by_phase

. program define trial_growth_by_phase
  1.         syntax, ///
>         [figure_path(string)] ///
>         [title(string)]
  2. 
.         preserve
  3.         
.         *Count number of trials by year and phase
.         collapse (sum) phase_1 phase_2 phase_3, by(year_start) 
  4.                 
.         *Scale each phase count so that their value in the first year == 0
.         quietly summarize year_start
  5.         local first_year `r(min)'
  6.         
.         foreach var of varlist phase_* {
  7.         quietly summarize `var' if year_start == `first_year'
  8.         local first_year_value `r(mean)' 
  9.         replace `var' = 100 * (`var'/`first_year_value' - 1)
 10.         }
 11.         
.         *Plot
.         if "`title'" == "" local title "Growth in number of registered Phase 
> I- III trials since 1995" 
 12.         graph twoway ///
>                 line phase_1 year_start || ///
>                 line phase_2 year_start || ///
>                 line phase_3 year_start , ///
>                 title("`title'", size(medium)) ///
>                         ytitle("Growth (%)") ///
>                         ylabel(0(200)2000,angle(0)) ///
>                         xtitle("Start year") ///
>                         legend( lab(1 "Phase I") ///
>                                 lab(2 "Phase II") ///
>                                 lab(3 "Phase III") ///
>                                 rows(1) ///
>                                 ) 
 13.         if "`figure_path'" != "" graph export "`figure_path'", replace
 14. 
.         restore
 15. end

. 
. 
. 
. cap program drop trial_share_withbmkr_by_phase

. program define trial_share_withbmkr_by_phase    
  1.         syntax, ///
>         [figure_path(string)] ///
>         [title(string)]
  2. 
.         preserve
  3.         
.         prep_phases
  4.         collapse (mean) biomarker_status, by(year_start phase) 
  5.         rename biomarker_status biomarker_share
  6.         replace biomarker_share = biomarker_share * 100
  7.         reshape wide biomarker_share, i(year_start) j(phase)
  8.         list in 1/20
  9.         
.         if "`title'" == "" local title "Share of trials using at least one bi
> omarker"
 10.         graph twoway ///
>                 line biomarker_share1 year_start || ///
>                 line biomarker_share2 year_start || ///
>                 line biomarker_share3 year_start , ///
>                 title("`title'") ///
>                 ytitle("Share of trials (%)", size(small))  ///
>                 ylabel(0(10)100, angle(0)) ///
>                 xtitle("Start year") ///
>                 legend( lab(1 "Phase I") ///
>                         lab(2 "Phase II") ///
>                         lab(3 "Phase III") ///
>                         rows(1) ///
>                         ) 
 11.         if "`figure_path'" != "" graph export "`figure_path'", replace
 12. 
.         restore
 13. end

. 
. 
. 
. /*
>         preserve
>         prep_phases
>         list phase in 1/10
>         estimates clear
>         eststo p1: quietly mean nih_funding, over(phase)
>         eststo p2: quietly mean nih_funding if us_trial == 1, over(phase)
>         
>         if "`title'" == "" local title "Share of trials receiving NIH funding
>  by Phase"
>         if "`table_path'" != "" local write_tex "using `table_path'"
> 
>         esttab p1 p2 `write_tex', ///
>                 title("`title'") ///
>                 coeflabels(_subpop_1 "Phase I" _subpop_2 "Phase II" _subpop_3
>  "Phase III") ///
>                 b(4) se nostar noobs ///
>                 scalar(N) sfmt(0) ///
>                 nonum label
> 
>         restore
> */
. 
. 
. 
. 
. 
. 
. 
. **All-time xtab of funding count by biomarker presence
. cap program drop nih_funding_by_bmkr

. program define nih_funding_by_bmkr
  1.         syntax, ///
>         [table_path(string)] ///
>         [title(string)]
  2.                 
.         preserve
  3.         
.         quietly estpost tabulate biomarker_status nih_funding
  4. 
.         if "`title'" == "" local title "Number of trials receiving NIH fundin
> g by presence of biomarker"
  5.         if "`table_path'" != "" local write_tex "using `table_path'"
  6.         
.         esttab . `write_tex', ///
>                 replace ///
>                 title(`title') ///
>                 b(%8.0gc) ///
>                 compress ///
>                 unstack ///
>                 noobs nonotes nonum ///
>                 label ///
>                                         
  7.         restore 
  8. end

. 
. 
. **All-time xtab of funding probability by biomarker presence and location (tr
> ial in US)
. cap program drop nih_funding_by_bmkr_us

. program define nih_funding_by_bmkr_us
  1.         syntax, ///
>         [table_path(string)] ///
>         [title(string)]
  2.                 
.         preserve
  3.         eststo clear
  4.                 
.         label variable nih_funding "Number of trials receiving funding"
  5.         
.         eststo A: quietly total nih_funding, over(biomarker_status)
  6.         eststo B: quietly total nih_funding if us_trial == 1, over(biomark
> er_status)
  7.         eststo C: quietly total nih_funding if us_trial == 0, over(biomark
> er_status)
  8.                 
.         if "`title'" == "" local title "Number of trials receiving NIH fundin
> g by presence of biomarker"
  9.         if "`table_path'" != "" local write_tex "using `table_path'"
 10.         
.         esttab A B C  `write_tex', ///
>                 replace ///
>                 title("`title'") ///
>                 label mtitle("All Trials" "US Trials" "Non-US Trials") ///
>                 cells(b se(fmt(a1) par)) ///
>                 collabels(none) ///
>                 rename(_subpop_1 "No biomarker") ///
>                 noobs ///
>                 fragment ///
>         
 11.         cap drop nih_times100
 12.         gen nih_times100 = nih_funding * 100
 13.         label variable nih_times100 "Percent of trials receiving funding"
 14. 
.         eststo A: quietly mean nih_times100, over(biomarker_status)
 15.         eststo B: quietly mean nih_times100 if us_trial == 1, over(biomark
> er_status)
 16.         eststo C: quietly mean nih_times100 if us_trial == 0, over(biomark
> er_status)
 17. 
.         esttab A B C `write_tex', ///
>                 append ///
>                 label ///
>                 mtitle("" "" "") ///
>                 cells(b(fmt(1)) se(fmt(2) par)) ///
>                 scalars(N) ///
>                 sfmt(%8.0gc) ///
>                 collabels(none) ///
>                 rename(_subpop_1 "No biomarker") ///
>                 nonum ///
>                 fragment                
 18.                                         
.         restore 
 19. end

. 
. 
. **All-time xtab of funding probability by biomarker presence and phase
. cap program drop nih_funding_by_bmkr_phase

. program define nih_funding_by_bmkr_phase
  1.         syntax, ///
>         [table_path(string)] ///
>         [title(string)]
  2.                 
.         preserve
  3.         eststo clear
  4.                 
.         label variable nih_funding "Number of trials receiving funding"
  5.         
.         
.         eststo A: quietly total nih_funding, over(biomarker_status)
  6.         eststo B: quietly total nih_funding if phase_1 == 1, over(biomarke
> r_status)
  7.         eststo C: quietly total nih_funding if phase_2 == 1, over(biomarke
> r_status)
  8.         eststo D: quietly total nih_funding if phase_3 == 1, over(biomarke
> r_status)
  9. 
.         if "`title'" == "" local title "Number of trials receiving NIH fundin
> g by presence of biomarker"                
 10.         if "`table_path'" != "" local write_tex "using `table_path'"
 11.         
.         esttab A B C D `write_tex', ///
>                 replace ///
>                 title("`title'") ///
>                 label mtitle("All Trials" "Phase I" "Phase II" "Phase III") /
> //
>                 cells(b se(fmt(a1) par)) ///
>                 collabels(none) ///
>                 rename(_subpop_1 "No biomarker") ///
>                 noobs nonum ///
>                 fragment ///
>                                         
 12.         cap drop nih_times100
 13.         gen nih_times100 = nih_funding * 100
 14.         label variable nih_times100 "Percent of trials receiving funding"
 15. 
.         eststo A: quietly mean nih_times100, over(biomarker_status)
 16.         eststo B: quietly mean nih_times100 if phase_1 == 1, over(biomarke
> r_status)
 17.         eststo C: quietly mean nih_times100 if phase_2 == 1, over(biomarke
> r_status)
 18.         eststo D: quietly mean nih_times100 if phase_3 == 1, over(biomarke
> r_status)
 19.                                         
.         esttab A B C D `write_tex', ///
>                 append ///
>                 label ///
>                 mtitle("" "" "" "") ///
>                 cells(b(fmt(1)) se(fmt(2) par)) ///
>                 scalars(N) ///
>                 sfmt(%8.0gc) ///
>                 collabels(none) ///
>                 rename(_subpop_1 "No biomarker") ///
>                 nonum ///
>                 fragment ///
>                                         
 20.         restore 
 21. end

. 
. 
. cap program drop nih_funding_by_bmkrrole

. program define nih_funding_by_bmkrrole
  1.         syntax, ///
>         [table_path(string)] ///
>         [title(string)]
  2.                 
.         preserve
  3.         eststo clear
  4.                 
.         cap drop nih_times100
  5.         gen nih_times100 = nih_funding * 100
  6.         label variable nih_times100 "Percent receiving funding"
  7.         
.         quietly mean nih_times100
  8.         estimates store all
  9.         
.         quietly mean nih_times100 if biomarker_status == 0
 10.         estimates store no_biomarker
 11.         
.         quietly mean nih_times100 if biomarker_status == 1
 12.         estimates store biomarker
 13.         
.         quietly mean nih_times100 if disease_marker_role == 1
 14.         estimates store disease
 15. 
.         quietly mean nih_times100 if therapeutic_marker_role == 1
 16.         estimates store therapeutic_effect
 17.         
.         quietly mean nih_times100 if toxic_marker_role == 1
 18.         estimates store toxic_effect
 19.                 
.         quietly mean nih_times100 if not_determined_marker_role == 1
 20.         estimates store not_determined
 21. 
.         if "`title'" == "" local title "Percent of trials receiving NIH fundi
> ng by biomarker role"                              
 22.         if "`table_path'" != "" local write_tex "using `table_path'"
 23.         esttab all no_biomarker biomarker disease therapeutic_effect toxic
> _effect not_determined ///
>                 `write_tex', ///
>                 replace ///
>                 nostar se b(1) ///
>                 mtitle( "All Trials" "No Biomarker" "Biomarker present" "Dise
> ase" ///
>                         "Therapeutic effect" "Toxic effect" "Role not determi
> ned") ///
>                 compress ///
>                 label ///
>                 title("Percent of trials receiving NIH funding by biomarker r
> ole") ///
>                 addnote("Trials may employ multiple biomarkers with one or mo
> re biomarker roles.") 
 24.                                         
.         restore 
 25. end

. 
. *Table of trial count by phase 
. cap program drop trial_phase

. program define trial_phase
  1.         syntax, ///
>         [table_path(string)] ///
>         [title(string)]
  2.                 
.         preserve
  3.         
.         quietly estpost tabulate phase
  4. 
.         if "`title'" == "" local title "Share of trials by Phase"            
>                    
  5.         if "`table_path'" != "" local write_tex "using `table_path'"
  6.         
.         esttab . `write_tex', ///
>                 replace                                         ///
>                 cells("b(fmt(%8.0gc)) pct(fmt(1))")             ///
>                 title("`title'")                        ///
>                 collabels("Trial count" "Percent of all Phase I-III") ///
>                 nomtitle                                        ///
>                 compress                                        ///
>                 noobs                                           ///
>                 nonum                                           ///
>                                         
  7.         restore 
  8. end

. 
. 
. **Table of variable means over nih funding status
. cap program drop nih_funding_means

. program define nih_funding_means
  1.         syntax, ///
>         [table_path(string)] ///
>         [title(string)]
  2.                 
.         preserve
  3.         
.         local vars      us_trial ///
>                         biomarker_status ///
>                         patient_count_enrollment ///
>                         duration                
  4. 
.         eststo all: quietly mean `vars'
  5.         eststo nih_yes: quietly mean `vars' if nih_funding == 0
  6.         eststo nih_no: quietly mean `vars' if nih_funding == 1
  7. 
.         if "`title'" == "" local title "Selected averages by NIH funding stat
> us"                                
  8.         if "`table_path'" != "" local write_tex "using `table_path'"
  9.         
.         esttab all nih_yes nih_no `write_tex', ///
>                 replace ///
>                 unstack ///
>                 cells("b(fmt(a2)) se(fmt(a2))") ///
>                 title("`title'") ///
>                 mtitles("All trials" "No NIH funding" "NIH funding") ///
>                 varlabels(      us_trial "US trial" biomarker_status "Biomark
> er used" ///
>                                 patient_count_enrollment "Subjects enrolled" 
> duration "Duration") ///
>                 collabels("Average" "Standard error") ///
>                 noobs compress
 10.                                         
.         restore 
 11. end

. 
. 
. **Table of average trial duration over years
. cap program drop trial_duration_by_yr

. program define trial_duration_by_yr
  1.         syntax, ///
>         [figure_path(string)] [table_path(string)] ///
>         [title(string)]
  2.                 
.         preserve
  3.         
.         local first_year 2000 
  4.         local last_year 2016
  5.         keep if year_end >= `first_year' & year_end <= `last_year'
  6.         prep_phases
  7.         if "`title'" == "" local title "Average trial duration in months" 
>                               
  8. 
.         *Plot
.         quietly reg duration i.year_end
  9.         quietly margins, over(year_end) post
 10.         marginsplot, ///
>                 title("`title'") ///
>                 xlabel(2000(5)2015) ///
>                 ylabel(18(6)54) ///
>                 xtitle("Trial end year") ///
>                 ytitle("Trial duration in months") 
 11.         if "`figure_path'" != "" graph export "`figure_path'", replace
 12.         
.         *Table
.         if "`table_path'" != "" local write_tex "using `table_path'"
 13.         esttab . `write_tex', ///
>                 replace ///
>                 cells("b(fmt(1)) _N(fmt(%8.0gc))") ///
>                 title("`title'") ///
>                 not nostar nonum ///
>                 label ///
>                 collabels("Duration (months)" "\# of trials with nonmissing d
> uration", lhs("End year"))
 14.                         
.         restore 
 15. end

. 
. 
. **Table of average trial duration over years by phase
. cap program drop trial_duration_by_yr_phase

. program define trial_duration_by_yr_phase
  1.         syntax, ///
>         [figure_path(string)] [table_path(string)] ///
>         [title(string)]
  2.                 
.         preserve
  3.         
.         local first_year 2000 
  4.         local last_year 2016
  5.         keep if year_end >= `first_year' & year_end <= `last_year'
  6.         prep_phases
  7. 
.         if "`title'" == "" local title "Average trial duration in months by t
> rial phase"                                
  8. 
.         *Plot
.         quietly reg duration i.year_end##i.phase
  9.         quietly margins, over(year_end phase) post
 10.         marginsplot, ///
>                 title("`title'") ///
>                 xlabel(2000(5)2015) ///
>                 ylabel(18(6)42) ///
>                 xtitle("Trial end year") ///
>                 ytitle("Trial duration in months") 
 11.         if "`figure_path'" != "" graph export "`figure_path'", replace
 12. 
.         *Table
.         if "`table_path'" != "" local write_tex "using `table_path'"
 13.         
.         foreach year of numlist `first_year'/`last_year' {
 14.         local i = `year' - `first_year' + 1
 15.         local labels `labels' _subpop_`i' `year'
 16.         }
 17. 
.         eststo A: quietly mean duration, over(year_end)
 18.         eststo B: quietly mean duration if phase == 1, over(year_end)
 19.         eststo C: quietly mean duration if phase == 2, over(year_end)
 20.         eststo D: quietly mean duration if phase == 3, over(year_end)
 21. 
.         label variable duration " "
 22.         if "`table_path'" != "" local write_tex "using `table_path'"
 23.         esttab A B C D  `write_tex', ///
>                         coeflabels(`labels') not nostar nonum ///
>                         replace ///
>                         label ///
>                         cells("_N(fmt(%8.0gc)) b(fmt(1))") ///
>                         title("`title'") ///
>                         collabels("Number of trials" "Average duration", lhs(
> "End year")) ///
>                         mtitles("All trials with start and end dates" ///
>                                 "Phase I" ///
>                                 "Phase II" ///
>                                 "Phase III" ///
>                                 )       
 24.         restore 
 25. end

. 
. 
. 
. **Table of average trial duration over years by biomarker status
. cap program drop trial_duration_by_yr_bmkr

. program define trial_duration_by_yr_bmkr
  1.         syntax, ///
>         [figure_path(string)] [table_path(string)] ///
>         [title(string)]
  2.                 
.         preserve
  3.         
.         local first_year 2000 
  4.         local last_year 2016
  5.         prep_duration, first_year(`first_year') last_year(`last_year') 
  6.         
.         if "`title'" == "" local title "Average trial duration in months by u
> se of biomarker"                           
  7. 
.         *Plot
.         quietly reg duration i.year_end##i.biomarker_status
  8.         quietly margins, over(year_end biomarker_status) post
  9.         marginsplot, ///
>                 title("`title'") ///
>                 xlabel(2000(5)2015) ///
>                 ylabel(18(6)42) ///
>                 xtitle("Trial end year") ///
>                 ytitle("Trial duration in months") 
 10.         if "`figure_path'" != "" graph export "`figure_path'", replace
 11. 
.         *Table  
.         foreach year of numlist `first_year'/`last_year' {
 12.         local i = `year' - `first_year' + 1
 13.         local labels `labels' _subpop_`i' `year'
 14.         }
 15. 
.         eststo A: quietly mean duration, over(year_end)
 16.         eststo B: quietly mean duration if biomarker_status == 0, over(yea
> r_end)
 17.         eststo C: quietly mean duration if biomarker_status == 1, over(yea
> r_end)
 18. 
.         label variable duration " "
 19.         if "`table_path'" != "" local write_tex "using `table_path'"
 20.         esttab A B C    `write_tex', ///
>                         coeflabels(`labels') not nostar nonum ///
>                         replace ///
>                         label ///
>                         cells(" _N(fmt(%8.0gc)) b(fmt(1))") ///
>                         title("`title'") ///
>                         collabels("Number of trials" "Average duration", lhs(
> "End year")) ///
>                         mtitles("All trials with start and end dates" ///
>                                 "No biomarkers" ///
>                                 "Biomarker(s) used" ///
>                                 )       
 21.         restore 
 22. end

. 
. 
. **Table of NIH funding probability over year by biomarker status
. cap program drop nih_funding_by_yr_bmkr

. program define nih_funding_by_yr_bmkr
  1.         syntax, ///
>         [figure_path(string)] [table_path(string)] ///
>         [title(string)]
  2.                 
.         preserve
  3. 
.         *define subset of trials
.         local first_year 1995
  4.         local last_year 2016
  5.         keep if year_start >= `first_year' & year_start <= `last_year'
  6. 
.         *scale response variable to percentage scale
.         cap drop nih_times100
  7.         gen nih_times100 = nih_funding * 100 
  8.         
.         if "`title'" == "" local title "Share of trials receiving NIH funding
>  by use of biomarker"                              
  9.         
.         *Plot
.         quietly reg nih_times100 i.year_start##i.biomarker_status
 10.         quietly margins, over(year_start biomarker_status) post
 11.         marginsplot, ///
>                 title("`title'") ///
>                 xlabel(1995(5)2015) ///
>                 ylabel(0(5)20) ///
>                 xtitle("Trial Start Year") ///
>                 ytitle("Share of trials receiving funding") ///
>                 yscale(r(0 20)) ///
>                 noci
 12.         if "`figure_path'" != "" graph export "`figure_path'", replace
 13. 
.         *Table
.         foreach year of numlist `first_year'/`last_year' {
 14.         local i = `year' - `first_year' + 1
 15.         local labels `labels' _subpop_`i' `year'
 16.         }
 17. 
.         eststo A: quietly mean nih_times100, over(year_start)
 18.         eststo B: quietly mean nih_times100 if biomarker_status == 0, over
> (year_start)
 19.         eststo C: quietly mean nih_times100 if biomarker_status == 1, over
> (year_start)
 20. 
.         label variable nih_times100 " "
 21.         if "`table_path'" != "" local write_tex "using `table_path'"
 22.         esttab A B C    `write_tex', ///
>                         coeflabels(`labels') not nostar nonum ///
>                         replace ///
>                         label ///
>                         cells("_N(fmt(%8.0gc)) b(fmt(1))") ///
>                         title("`title'") ///
>                         collabels("Number of trials" "Percent funded", lhs("S
> tart year")) ///
>                         mtitles("All trials with start and end dates" ///
>                                 "No biomarkers" ///
>                                 "Biomarker(s) used" ///
>                                 )       
 23.         restore 
 24. end

. 
. **Table of NIH funding probability over year by phase
. cap program drop nih_funding_by_yr_phase

. program define nih_funding_by_yr_phase
  1.         syntax, ///
>         [figure_path(string)] [table_path(string)] ///
>         [title(string)]
  2.                 
.         preserve
  3. 
.         *define subset of trials
.         local first_year 1995
  4.         local last_year 2016
  5.         keep if year_start >= `first_year' & year_start <= `last_year'
  6.         prep_phases
  7. 
.         *scale response variable to percentage scale
.         cap drop nih_times100
  8.         gen nih_times100 = nih_funding * 100 
  9.         
.         if "`title'" == "" local title "Percent of trials receiving NIH fundi
> ng by Phase"                               
 10.         
.         *Plot
.         quietly reg nih_times100 i.year_start##i.phase
 11.         quietly margins, over(year_start phase) post
 12.         marginsplot, ///
>                 title("`title'") ///
>                 xtitle("Trial Start Year") ///
>                 ytitle("Share of trials receiving funding (%)") ///
>                 xlabel(1995(5)2015) ///
>                 ylabel(, angle(0)) ///
>                 yscale(titlegap(*-30)) ///
>                 legend(rows(1)) ///
>                 noci
 13.                 
.         if "`figure_path'" != "" graph export "`figure_path'", replace
 14. 
.         *Table
.         foreach year of numlist `first_year'/`last_year' {
 15.         local i = `year' - `first_year' + 1
 16.         local labels `labels' _subpop_`i' `year'
 17.         }
 18.         
.         format nih_times100 %1.0f
 19.         format phase_123 %16H
 20. 
.         eststo clear    
 21.         eststo A: quietly mean nih_times100 if phase_123 == 1 , over(year_
> start)
 22.         eststo B: quietly mean nih_times100 if phase == 1 , over(year_star
> t)
 23.         eststo C: quietly mean nih_times100 if phase == 2 , over(year_star
> t)
 24.         eststo D: quietly mean nih_times100 if phase == 3 , over(year_star
> t)
 25. 
.         label variable nih_times100 " "
 26.         if "`table_path'" != "" local write_tex "using `table_path'"
 27.         esttab A B C D `write_tex', ///
>                         replace ///
>                         title("`title'") ///
>                         mtitle("Phase I-III" "Phase I" "Phase II" "Phase III"
> ) ///
>                         coeflabels(`labels') ///
>                         collabels("Number of trials" "Percent funded", lhs("S
> tart year")) ///
>                         not nostar nogaps nonum ///
>                         scalars(N) ///
>                         compress  label ///
>                         cells("_N(fmt(%8.0gc)) b(fmt(1))" ) ///
>                         
 28.         restore 
 29. end

. 
. 
. 
. 
. 
. 
end of do-file

. 
. 
. *****************************************************************************
> ***
. *****************************************************************************
> ***
. *****************************************************************************
> ***
. *****************************************************************************
> ***
. 
. **Run programs to generate tables/figures
. *Table 1
. summary_stats, table_path("`table_dir'/01-summary_stats.tex")
(output written to reports/report_08-01-17/tables/01-summary_stats.tex)

. 
. *Table 9 
. nih_funding_by_phase, table_path("`table_dir'/09-nih_funding_by_phase.tex")
(output written to reports/report_08-01-17/tables/09-nih_funding_by_phase.tex)

. 
. *Figure 1a
. trial_count_by_phase, figure_path("`figure_dir'/01a-trial_count_by_phase.eps"
> )
(file reports/report_08-01-17/figures/01a-trial_count_by_phase.eps written in E
> PS format)

. *Figure 1b
. trial_growth_by_phase, figure_path("`figure_dir'/01b-trial_growth_by_phase.ep
> s")
(22 real changes made)
(22 real changes made)
(22 real changes made)
(file reports/report_08-01-17/figures/01b-trial_growth_by_phase.eps written in 
> EPS format)

. 
. *Figure 2a
. preserve

. keep if biomarker_status == 1
(77,973 observations deleted)

. trial_count_by_phase, ///
>         figure_path("`figure_dir'/02a-trial_count_by_phase_withbmkr.eps") ///
>         title("Number of registered Phase I-III trials using biomarkers (1995
> -2016)")
(file reports/report_08-01-17/figures/02a-trial_count_by_phase_withbmkr.eps wri
> tten in EPS format)

. restore

. *Figure 2b
. trial_share_withbmkr_by_phase, figure_path("`figure_dir'/02b-trial_share_with
> bmkr_by_phase.eps")
(131,971 missing values generated)
(43,615 real changes made)
(57,636 real changes made)
(30,720 real changes made)
(66 real changes made)
(note: j = 1 2 3)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                       66   ->      22
Number of variables                   3   ->       4
j variable (3 values)             phase   ->   (dropped)
xij variables:
                        biomarker_share   ->   biomarker_share1 biomarker_share
> 2 biomarker_share3
-----------------------------------------------------------------------------

     +----------------------------------------------------+
     | year_s~t   biomarker~1   biomarker~2   biomarker~3 |
     |----------------------------------------------------|
  1. |     1995    7.48502994   11.35646688   20.46511628 |
  2. |     1996   8.259587021   14.93670886    18.6440678 |
  3. |     1997            10   11.93737769   24.09972299 |
  4. |     1998   10.86206897   16.28571429   26.17924528 |
  5. |     1999    16.8997669   16.63113006    24.0589198 |
     |----------------------------------------------------|
  6. |     2000   13.67713004   21.14285714    28.9897511 |
  7. |     2001    16.3141994   21.78137652   27.97385621 |
  8. |     2002   15.36458333   24.66539197   30.59177533 |
  9. |     2003   19.57379637   26.95800227   31.18001723 |
 10. |     2004   23.10730744    30.9009009   32.97224103 |
     |----------------------------------------------------|
 11. |     2005    26.0704607    30.7254623   33.31428571 |
 12. |     2006   25.86046512   33.34410339   35.83635422 |
 13. |     2007   32.11709801    37.4284854    38.2118148 |
 14. |     2008    33.6203669   38.90675241   40.37460978 |
 15. |     2009   36.96524064   43.83223684   42.35737352 |
     |----------------------------------------------------|
 16. |     2010   41.29803035   48.26075048   44.01408451 |
 17. |     2011   43.36226294   49.05611585   48.63793957 |
 18. |     2012   43.98026316   51.47305389   50.19474197 |
 19. |     2013   49.14586071   53.04953946   50.86872587 |
 20. |     2014     49.276646   56.45747516   57.05394191 |
     +----------------------------------------------------+
(file reports/report_08-01-17/figures/02b-trial_share_withbmkr_by_phase.eps wri
> tten in EPS format)

. 
. *Figure 9a
. nih_funding_by_yr_phase, figure_path("`figure_dir'/09a-nih_funding_by_yr_phas
> e.eps")
(0 observations deleted)
(131,971 missing values generated)
(43,615 real changes made)
(57,636 real changes made)
(30,720 real changes made)

  Variables that uniquely identify margins: year_start phase
(file reports/report_08-01-17/figures/09a-nih_funding_by_yr_phase.eps written i
> n EPS format)

Percent of trials receiving NIH funding by Phase
-------------------------------------------------------------------------------
> -----------------
                 Phase I~I             Phase I            Phase II           Ph
> ase III          
Start year       Number ~s Percent~d Number ~s Percent~d Number ~s Percent~d Nu
> mber ~s Percent~d
-------------------------------------------------------------------------------
> -----------------
                                                                               
>                  
1995                   866       3.8       334       2.1       317       6.0   
>     215       3.3
1996                   970       4.0       339       3.5       395       4.8   
>     236       3.4
1997                 1,322       5.8       450       5.6       511       8.0   
>     361       3.0
1998                 1,704       4.8       580       5.3       700       6.0   
>     424       1.9
1999                 2,407       4.9       858       4.1       938       6.9   
>     611       2.9
2000                 2,625       5.6       892       7.3     1,050       6.1   
>     683       2.6
2001                 2,993       4.7       993       4.7     1,235       5.7   
>     765       3.3
2002                 3,718       4.0     1,152       3.9     1,569       5.0   
>     997       2.5
2003                 4,190       3.9     1,267       5.1     1,762       4.1   
>   1,161       2.1
2004                 5,216       4.0     1,519       4.1     2,220       5.8   
>   1,477       1.2
2005                 6,407       3.9     1,845       4.3     2,812       4.9   
>   1,750       1.6
2006                 7,176       3.5     2,150       4.0     3,095       4.7   
>   1,931       1.0
2007                 7,557       2.8     2,357       3.2     3,321       3.7   
>   1,879       0.7
2008                 8,014       2.9     2,671       3.3     3,421       3.6   
>   1,922       0.9
2009                 8,498       2.8     2,992       3.5     3,648       3.2   
>   1,858       0.8
2010                 8,736       2.2     3,097       2.7     3,651       2.5   
>   1,988       0.8
2011                 8,997       1.9     3,111       2.0     3,867       2.4   
>   2,019       0.7
2012                 9,269       1.7     3,040       2.1     4,175       2.0   
>   2,054       0.2
2013                 9,133       2.2     3,044       2.7     4,017       2.8   
>   2,072       0.3
2014                 9,442       2.2     3,387       3.1     4,127       2.3   
>   1,928       0.5
2015                10,569       2.2     3,497       2.6     4,872       2.5   
>   2,200       0.8
2016                12,162       1.9     4,040       2.7     5,933       1.9   
>   2,189       0.6
-------------------------------------------------------------------------------
> -----------------
Observations        131971               43615               57636             
>   30720          
-------------------------------------------------------------------------------
> -----------------

. 
. 
. 
. 
. 
. 
. /*
> nih_funding_by_bmkr,            table_path("`table_dir'/01-nih_funding_by_bmk
> r.tex")
> nih_funding_by_bmkr_us,         table_path("`table_dir'/fragment-02-nih_fundi
> ng_by_bmkr_us.tex")
> nih_funding_by_bmkr_phase,      table_path("`table_dir'/fragment-03-nih_fundi
> ng_by_bmkr_phase.tex")
> nih_funding_by_bmkrrole,        table_path("`table_dir'/04-nih_funding_by_bmk
> rrole.tex")
> trial_phase,                    table_path("`table_dir'/05-trial_phase.tex")
> trial_duration_by_yr,           table_path("`table_dir'/06-trial_duration_by_
> yr.tex") ///
>                                         figure_path("`figure_dir'/06-trial_du
> ration_by_yr.eps")
> nih_funding_means,              table_path("`table_dir'/07-nih_funding_means.
> tex")
> trial_duration_by_yr_phase,     figure_path("`figure_dir'/05-trial_duration_b
> y_yr_phase.eps")
> trial_duration_by_yr_bmkr,      table_path("`table_dir'/11-trial_duration_by_
> yr_bmkr.tex") ///
>                                         figure_path("`figure_dir'/04-trial_du
> ration_by_yr_bmkr.eps")
> nih_funding_by_yr_bmkr,         table_path("`table_dir'/08-nih_funding_by_yr_
> bmkr.tex") ///
>                                         figure_path("`figure_dir'/01-nih_fund
> ing_by_yr_bmkr.eps")
> 
> preserve
> keep if us_trial == 1                                   
> nih_funding_by_yr_bmkr,         table_path("`table_dir'/09-nih_funding_by_yr_
> bmkr_us.tex") ///
>                                         figure_path("`figure_dir'/02-nih_fund
> ing_by_yr_bmkr_us.eps")                                    
> restore
>                                         
> nih_funding_by_yr_phase,        table_path("`table_dir'/10-nih_funding_by_yr_
> phase.tex") ///
>                                         figure_path("`figure_dir'/03-nih_fund
> ing_by_yr_phase.eps")
> 
> 
> 
> 
> 
> 

end of do-file
